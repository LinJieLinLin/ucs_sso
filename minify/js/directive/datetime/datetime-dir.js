directiveSso.directive("datetime",function(){return{template:'<span ng-style="style"><input type="text" ng-class="config.class" ng-model="value" placeholder="{{config.placeholder}}" ng-click="toggle($event)" readonly /></span>',restrict:"E",replace:!0,transclude:!0,scope:{value:"=value",startdate:"=startdate",enddate:"=enddate",config:"=config"},controller:["$scope","$element","$document","$compile","$interval","datetimeService",function(e,t,a,n,c,r){e.style={position:"relative",display:"inline-block",cursor:"default"},e.config.noInput&&(e.style.display="none"),e.toggle=function(i){return r.tpl&&(a.unbind("click"),r.tpl.remove(),r.tag===t)?(delete r.tpl,void c.cancel(r.clockTimer)):(r.tag=t,r.tpl=n('<datetime-tpl value="value" config="config"></datetime-tpl>')(e),e.config.noInput?e.config.targetElement.append(r.tpl):t.append(r.tpl),a.bind("click",e.toggle),void i.stopPropagation())},r.toggle=e.toggle}]}}),directiveSso.directive("datetimeTpl",function(){return{template:["<div ng-class=\"timeFlag ? 'datetime-w and-time-style' : 'datetime-w'\" ng-click=\"stopPropagation($event)\">",'<div style="cursor:default">','<em class="arrow-ic"></em>','<div class="show-time-box">','<div class="now-time">',"<p>当前时间</p>","<span>{{clockString}}</span>","</div>",'<div style="padding: 15px 0px;">',"<select ",'class="hour" ','ng-options="item.str for item in hourList" ','ng-model="repeatData.hour" ','ng-change="change({hour: repeatData.hour})"></select>',"</div>","<div>","<select ",'class="minute" ','ng-options="item.str for item in minuteList" ','ng-model="repeatData.minute" ','ng-change="change({minute: repeatData.minute})"></select>',"</div>","</div>",'<div class="show-date-box">','<div class="t">','<a href="javascript:;" class="p" title="上一月" ng-click="mBefore()"></a>','<a href="javascript:;" class="n" title="下一月" ng-click="mAfter()"></a>',"<select ",'class="y" ','ng-options="item.str for item in yearList" ','ng-model="repeatData.year" ','ng-change="change({year: repeatData.year})"></select>',"<select ",'class="m" ','ng-options="item.str for item in monthList" ','ng-model="repeatData.month" ','ng-change="change({month: repeatData.month})"></select>','<div class="w">',"<h4>一</h4>","<h4>二</h4>","<h4>三</h4>","<h4>四</h4>","<h4>五</h4>","<h4>六</h4>","<h4>日</h4>","</div>","</div>",'<div class="c">','<a ng-repeat="item in dayList" ng-class="item.class" ng-click="change({day: item})">{{item.val}}</a>',"</div>",'<div class="f">','<a href="javascript:;" class="clear" ng-click="clearValue()">清空</a>','<a href="javascript:;" class="today" ng-click="today()">今日</a>','<a href="javascript:;" class="cancel" ng-click="cancel()">取消</a>',"</div>","</div>","</div>","</div>"].join(""),restrict:"E",replace:!0,transclude:!0,scope:{value:"=value",config:"=config"},controller:["$scope","$element","$timeout","$interval","$document","datetimeService",function(e,t,a,n,c,r){function i(e,t){for(var a=e+"";a.length<t;)a="0"+a;return a}function l(t,a,n,c,r){for(var l=[];a>t;){var o={val:t,str:i("month"===c[0]?t+1:t,n)+(r||"")};l.push(o),o.val===c[1]&&(e.repeatData[c[0]]=o),t+=1}return l}function o(t,a,n){var c=new Date,r=c.getFullYear(),i=c.getMonth(),l=c.getDate(),o=e.newDate.getFullYear(),s=e.newDate.getMonth(),u=e.newDate.getDate(),g="d ",d=function(e){e&&(g+="d-able "),t===o&&a===s&&n===u&&(g+=e?"d-now ":"d-disabled ")};return d(e.expiredFlag?r>t||t===r&&i>a||t===r&&a===i&&l>=n:e.realFlag?t>r||t===r&&a>i||t===r&&a===i&&n>=l:!0),g}function s(e){return e%4===0&&e%100!==0||e%400===0}function u(e,t){return 1===t||3===t||5===t||7===t||8===t||10===t||12===t?31:4===t||6===t||9===t||11===t?30:2===t&&s(e)?29:28}function g(e,t){var a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in a)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?a[n]:("00"+a[n]).substr((""+a[n]).length)));return t}e.oldDate=new Date,e.newDate=new Date,e.curDate=new Date,e.repeatData={},e.expiredFlag=e.config.style.match("expired"),e.realFlag=e.config.style.match("real"),e.timeFlag=e.config.style.match("time"),e.formatType=e.timeFlag?"yyyy-MM-dd hh:mm":"yyyy-MM-dd",e.setSelect=function(t,a,n,c){e.yearList=l(1901,t+100,4,["year",t],"年"),e.monthList=l(0,12,2,["month",a],"月"),e.hourList=l(0,24,2,["hour",n],"点"),e.minuteList=l(0,60,2,["minute",c],"分")},e.setDay=function(t,a,n){e.dayList=function(){for(var c=[],r=0,i=new Date(t+"-"+(a+1)+"-1"),l=i.getDay()?i.getDay():7,s=u(t,a+1);42>r;){var g=r>=l-1&&s+(l-1)>r?r-(l-2):"",d=g?o(t,a,g):"d",p={val:g,"class":d};c.push(p),p.val===n&&(e.repeatData.day=p),r+=1}return c}()},e.mBefore=function(){var t=e.curDate.getMonth()-1;0>t&&(e.curDate.setFullYear(e.curDate.getFullYear()-1),t=11),e.curDate.setMonth(t),e.reset()},e.mAfter=function(){var t=e.curDate.getMonth()+1;t>11&&(e.curDate.setFullYear(e.curDate.getFullYear()+1),t=0),e.curDate.setMonth(t),e.reset()},e.change=function(a){angular.forEach(a,function(a,c){switch(c){case"year":e.curDate.setFullYear(a.val),e.reset();break;case"month":e.curDate.setMonth(a.val),e.reset();break;case"day":a["class"].match(/d-able|d-now/)&&(e.curDate.setDate(a.val),e.setValue(e.curDate),e.timeFlag?e.reset():(t.remove(),n.cancel(r.clockTimer)));break;case"hour":e.curDate.setHours(a.val),e.initValue&&(e.setValue(e.curDate),e.reset());break;case"minute":e.curDate.setMinutes(a.val),e.initValue&&(e.setValue(e.curDate),e.reset())}})},e.clear=function(a,c,i){var l=a||new Date;e.setData(e.newDate,l),e.setData(e.curDate,l),e.value=c||"",e.reset(),i||(t.remove(),n.cancel(r.clockTimer))},e.clearValue=function(){e.clear(),"function"==typeof r.onClear&&r.onClear()},e.today=function(){var t=new Date;e.clear(t,g(t,e.formatType))},e.cancel=function(){e.initValue?(e.setValue(e.oldDate),e.reset()):e.clear(),t.remove(),n.cancel(r.clockTimer)},e.stopPropagation=function(e){e.stopPropagation()},e.setData=function(e,t){e.setFullYear(t.getFullYear()),e.setMonth(t.getMonth()),e.setDate(t.getDate()),e.setHours(t.getHours()),e.setMinutes(t.getMinutes())},e.setValue=function(t){e.setData(e.newDate,t),e.setData(e.curDate,t),e.value=g(e.newDate,e.formatType)},e.reset=function(){var t=e.curDate.getFullYear(),a=e.curDate.getMonth(),n=e.curDate.getDate(),c=e.curDate.getHours(),r=e.curDate.getMinutes();e.setSelect(t,a,c,r),e.setDay(t,a,n)},e.clock=function(){var t=new Date;e.clockString=i(t.getHours(),2)+":"+i(t.getMinutes(),2)+":"+i(t.getSeconds(),2)},e.locate=function(){var a=angular.element(window).width(),n=angular.element(window).height(),c=t.width(),r=t.height(),i=t.prev().height(),l=t.parent().offset().top-angular.element(window).scrollTop(),o=n-(l+i),s=t.parent().offset().left,u=a-(s+c),g=0,d=0,p=function(e,t,a,n){return t+a>n&&(e=n-(t+a+10),-t>e&&(e=-t)),e},f=function(n){d=p(d,s,c,a),t.addClass(n).css({left:d}),e.config.position?(t.css({bottom:30}),t.find(".arrow-ic").css({left:20})):t.find(".arrow-ic").css({left:-d+20})},m=function(e){g=p(g,l,r,n),t.addClass(e).css({top:g}),t.find(".arrow-ic").css({top:-g+i/2})},h=function(e){s+c>a&&s>c?m("dtt-w-l-sty"):c/2>s&&u>c?m("dtt-w-r-sty"):f(e)},v=function(e){m(e)};if(e.config.position)switch(d=-(28-e.config.targetElement.width()/2),e.config.position){case"top":h("dtt-w-t-sty");break;case"bottom":h("dtt-w-b-sty");break;case"left":v("dtt-w-l-sty");break;case"right":v("dtt-w-r-sty")}else o>=r?h("dtt-w-b-sty"):l>=r?h("dtt-w-t-sty"):v(s>u?"dtt-w-l-sty":"dtt-w-r-sty")},e.run=function(){e.initValue=e.value;var t=e.value?new Date(e.value.replace(/-|\./g,"/")):new Date;if(!angular.isDate(t))return void console.error("oldDate is not Date Object");e.value?(e.setData(e.oldDate,t),e.clear(t,g(t,e.formatType),"init")):e.clear(t,"","init");var c=e.oldDate.getFullYear(),i=e.oldDate.getMonth(),l=e.oldDate.getDate(),o=e.oldDate.getHours(),s=e.oldDate.getMinutes();e.setSelect(c,i,o,s),e.setDay(c,i,l),a(e.locate,80),e.timeFlag&&(e.clock(),n.cancel(r.clockTimer),r.clockTimer=n(e.clock,1e3))},e.run()}]}}),directiveSso.factory("datetimeService",function(){return{}});