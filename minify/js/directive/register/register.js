try{directiveSso}catch(e){directiveSso=angular.module("directiveSso",[])}directiveSso.directive("registerSso",function(){return{templateUrl:"js/directive/register/register.html",restrict:"E",replace:!0,transclude:!0,scope:{c:"="},controller:["$scope","$timeout","$http","request",function(t,a,r,c){var o="http://localhost:7700/";t.rData={},t.msg={},t.focus={},t.regExp={account:/^[a-zA-Z0-9_\u4e00-\u9fa5]{2,50}$/,email:/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/,tel:/^1[3|4|5|7|8][0-9]\d{8}$/,id:/(^\d{15}$)|(^\d{17}([0-9]|X)$)/},t.initUrl=function(){t.requestUrl={register:o+"sso/api/create",checkExist:o+"sso/api/exist",eg:o+"api"}},t.readConfig=function(a){var e={};if(t.c)e=t.c;else try{e=DYCONFIG[a]}catch(r){}e&&(o=e.rUrl)},t.init=function(){t.readConfig("sso"),"/"!==o[o.length-1]&&(o+="/"),t.registerText="注册",localStorage.rAccount&&(t.rData.account=localStorage.rAccount),t.initUrl()},t.init(),t.keydown=function(a){e=a?a:window.event?window.event:null,13==e.keyCode&&t.registerSso()},t.checkFocus=function(a){t.focus[a]=1},t.checkAccount=function(){var a={usrs:t.rData.account},e={method:"GET",url:t.requestUrl.checkExist,params:a};c(e).then(function(a){a.data&&1===a.data[t.rData.account]&&(t.msg.account="用户名已存在")},function(t){console.log(t)})},t.checkFunc={},t.checkFunc.account=function(a){try{a.account=$("#account").val()}catch(e){}if(!a.account)return t.msg.account="请输入邮箱/用户名/手机号",-1;var r="请输入2-20位的邮箱/用户名/手机号";return t.regExp.email.test(a.account)&&(a.email=a.account,r=""),t.regExp.tel.test(a.account)&&(a.tel=a.account,r=""),t.regExp.account.test(a.account)&&(r=""),t.msg.account=r,t.msg.account?-1:(t.checkAccount(),t.msg.account?-1:(localStorage.rAccount=t.rData.account,0))},t.checkFunc.password=function(a){return a.password?a.password.length<6?(t.msg.password="密码至少6位",-1):0:(t.msg.password="请输入密码",-1)},t.checkFunc.rePassword=function(a){return a.password!==a.rePassword?(t.msg.rePassword="两次密码不一致！",-1):0},t.checkRegisterSso=function(a,e){t.focus={},e&&(t.msg[e]="");if(!e){for(var r in t.checkFunc)if(t.checkFunc[r](a))return t.checkFunc[r](a);return 0}try{return t.checkFunc[e](a)}catch(c){return 0}};var n=function(t){var a=window.location.search.match(new RegExp("[?&]"+t+"=([^&]+)","i"));return a?decodeURIComponent(a[1]):""};t.registerSso=function(){if("注册"===t.registerText&&!t.msg.account){var a=t.checkRegisterSso(t.rData);if(0===a){var e={usr:[t.rData.account],pwd:t.rData.password,attrs:{basic:{email:t.rData.email||"",phone:t.rData.tel||""}}},r={method:"POST",url:t.requestUrl.register,data:angular.toJson(e),params:{login:1}};t.registerText="正在注册...",c(r).then(function(a){a.data.token||(a.data.token=a.msg),t.registerText="注册",t.rData.password="",t.rData.rePassword="",t.rData.email="",t.rData.tel="",localStorage.account=t.rData.account,localStorage.rAccount="";var e=n("url");a.data.usr;if(""===e)return void(window.location.href="my.html?token="+a.data.token);var r=e.split("#");e=r[0];var c=r[1]?"#"+r[1]:"";e.match("^.*\\?.*$")?window.location.href=e+"&token="+a.data.token+c:window.location.href=e+"?token="+a.data.token+c},function(a){switch(t.registerText="注册",t.rData.password="",t.rData.rePassword="",a.data.data.code){case 1:a.data.data.dmsg="参数错误";break;case 2:a.data.data.dmsg="参数错误";break;case 3:localStorage.rAccount="",a.data.data.dmsg="用户已存在";break;default:a.data.data.dmsg="参数错误"}try{binApp.alert(a.data.data.dmsg||"请重试",{action:"top"})}catch(e){alert(a.data.data.msg||"请重试")}})}else{if(-1===a)return;try{binApp.alert(a,{action:"top"})}catch(o){alert(a)}}}}}]}}),directiveSso.factory("request",["$http","$q",function(t,a){return function(e){return t(e).then(function(t){var e=a.defer();return angular.isUndefined(t.data.code)?e.reject({type:-1,data:t}):0!==t.data.code?e.reject({type:1,data:t}):e.resolve(t.data),e.promise},function(t){throw{type:-1,data:t}})}}]);