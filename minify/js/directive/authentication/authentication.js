try{directiveSso}catch(e){directiveSso=angular.module("directiveSso",[])}directiveSso.directive("authentication",function(){return{templateUrl:"js/directive/authentication/authentication.html",restrict:"E",replace:!0,transclude:!0,scope:{c:"="},controller:["$scope","$timeout","$http","request",function(t,e,a,r){var o="http://localhost:7700/";t.init=function(){t.userInfo={};var e=ssoC.queryString("p");angular.isDefined(e)&&("1"===e?localStorage.step||(localStorage.step=2,localStorage.applySpacePage=1):"2"===e&&(localStorage.step||(localStorage.step=3,localStorage.applySpacePage=1))),t.page=0,t.step=0;var a=localStorage.step,r=localStorage.applySpacePage;angular.isDefined(a)&&angular.isNumber(Number(a))&&(t.step=a),angular.isDefined(r)&&angular.isNumber(Number(r))&&(t.page=r),"/"!==o[o.length-1]&&(o+="/"),t.regExp={name:/^[a-zA-Z0-9_\u4e00-\u9fa5]{2,50}$/,email:/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/,"class":/^[a-zA-Z0-9_\u4e00-\u9fa5,，;；、]{2,50}$/,tel:/^1[3|4|5|7|8][0-9]\d{8}$/,id:/(^\d{15}$)|(^\d{17}([0-9]|X)$)/},t.teacherData=[{img:"/sso/js/directive/authentication/img/t1.png",name:"金老师",category:"广州大学优秀教师"},{img:"/sso/js/directive/authentication/img/t2.png",name:"李老师",category:"广州大学优秀教师"},{img:"/sso/js/directive/authentication/img/t3.png",name:"陈老师",category:"广州大学优秀教师"},{img:"/sso/js/directive/authentication/img/t4.png",name:"黄老师",category:"广州大学优秀教师"},{img:"/sso/js/directive/authentication/img/t5.png",name:"徐老师",category:"广州大学优秀教师"}],t.problems=[{title:"申请实名认证的条件",href:""},{title:"实名认证失败原因",href:""},{title:"实名认证小贴士",href:""}],t.data={realName:"",school:"",grade:"",subject:"",phone:"",email:"",intention:""},t.agree=!1,o=t.readConfig("sso")||o,t.initUrl()},t.initUrl=function(){t.requestUrl={updateUserinfo:o+"usr/api/update",eg:o+"api"}},t.readConfig=function(e){var a={};if(t.c)a=t.c;else try{a=DYCONFIG[e]}catch(r){}return a.rUrl&&"/"!==a.rUrl[a.rUrl.length-1]&&(a.rUrl+="/"),a.rUrl},t.next=function(e){return t.agree&&1===e?(localStorage.step=1,void(t.step=1)):(localStorage.step=0,void(t.step=0))},t.submitData=function(){if(""!==t.data.realName&&""!==t.data.school&&""!==t.data.grade&&""!==t.data.subject&&""!==t.data.phone){var e={attrs:{certification:{realName:t.data.realName,school:t.data.school,grade:t.data.grade,subject:t.data.subject,phone:t.data.phone,email:t.data.email,intention:t.data.intention,status:"1"}}},a={method:"POST",url:t.requestUrl.updateUserinfo,data:angular.toJson(e),params:{}};r(a).then(function(e){try{binApp.alert("提交成功",{action:"top"})}catch(a){alert("提交成功")}localStorage.step=2,t.step=2},function(t){console.log(t)})}},t.changePage=function(e){t.page=e,localStorage.applySpacePage=e},t.toStep=function(e){angular.isNumber(Number(e))&&(0!==e||0===t.step||1===t.step)&&(1!==e&&5!==e&&(localStorage.step=e),t.step=e)},t.$on("login",function(e,a){if(!a.login){var r=location.origin+location.pathname;return void ssoC.redirect(!1,"登录",{url:encodeURIComponent(r)})}t.userInfo=a,console.log(a),t.userInfo&&!angular.isUndefined(t.userInfo.attrs)&&(t.userInfo.attrs.certification&&"1"===t.userInfo.attrs.certification.status?(localStorage.step=2,localStorage.applySpacePage=1,t.step=2,t.page=1):t.userInfo.attrs.certification?t.userInfo.attrs.certification&&"false"===t.userInfo.attrs.pass.status?(localStorage.step=3,localStorage.applySpacePage=1,t.step=3,t.page=1,t.data={realName:t.userInfo.attrs.certification.realName,school:t.userInfo.attrs.certification.school,grade:t.userInfo.attrs.certification.grade,subject:t.userInfo.attrs.certification.subject,phone:t.userInfo.attrs.certification.phone,email:t.userInfo.attrs.certification.email,intention:t.userInfo.attrs.certification.intention}):t.userInfo.attrs.certification&&"true"===t.userInfo.attrs.pass.status&&(localStorage.step=4,localStorage.applySpacePage=1,t.step=4,t.page=1,t.data={realName:t.userInfo.attrs.certification.realName,school:t.userInfo.attrs.certification.school,grade:t.userInfo.attrs.certification.grade,subject:t.userInfo.attrs.certification.subject,phone:t.userInfo.attrs.certification.phone,email:t.userInfo.attrs.certification.email,intention:t.userInfo.attrs.certification.intention}):localStorage.step>=2&&(localStorage.step=0,localStorage.applySpacePage=0,t.page=0,t.step=0))}),t.init()}]}}),directiveSso.factory("request",["$http","$q",function(t,e){return function(a){return t(a).then(function(t){var a=e.defer();return angular.isUndefined(t.data.code)?a.reject({type:-1,data:t}):0!==t.data.code?a.reject({type:1,data:t}):a.resolve(t.data),a.promise},function(t){throw{type:-1,data:t}})}}]);