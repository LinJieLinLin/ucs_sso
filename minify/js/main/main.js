var directiveSso=angular.module("directiveSso",[]),SSO=angular.module("SSO",["directive","directiveSso"]);SSO.controller("mainCtrl",["$scope","request","$rootScope",function(o,t,r){var e={};o.initUrl=function(){o.requestUrl={checkLogin:e.rUrl+"sso/api/uinfo",logout:e.rUrl+"sso/api/logout",eg:e.rUrl+"api"}},o.init=function(){e=ssoC.readConfig("sso"),o.headerConfig={rUrl:e.rUrl},o.loginConfig={rUrl:e.rUrl},o.registerConfig={rUrl:e.rUrl},o.initUrl(),o.checkLogin()},o.checkLogin=function(){var e={method:"GET",url:o.requestUrl.checkLogin,params:{}};t(e).then(function(o){if(console.log("login"),o.data&&o.data.usr&&(r.userData=o.data.usr,r.userData.login=!0,r.$broadcast("login",r.userData),"/sso/"===location.pathname||"/sso/register.html"===location.pathname||"/context.html"===location.pathname)){var t=ssoC.queryString("url");o.data.usr;if(""===t)return void(window.location.href="my.html?token="+ssoC.getToken());var e=t.split("#");t=e[0];var n=e[1]?"#"+e[1]:"";t.match("^.*\\?.*$")?window.location.href=t+"&token="+ssoC.getToken()+n:window.location.href=t+"?token="+ssoC.getToken()+n}},function(o){console.log("not login"),r.userData={},r.userData.login=!1,r.$broadcast("login",r.userData)})},o.logout=function(){var r={method:"GET",url:o.requestUrl.logout,params:{}};t(r).then(function(o){"OK"===o.data&&(ssoC.clearLocalStorage(),location.href="/sso")},function(o){console.log("logout error")})},o.init()}]),SSO.factory("request",["$http","$q",function(o,t){return function(r){return o(r).then(function(o){var r=t.defer();return angular.isUndefined(o.data.code)?r.reject({type:-1,data:o}):0!==o.data.code?r.reject({type:1,data:o}):r.resolve(o.data),r.promise},function(o){throw{type:-1,data:o}})}}]);